<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FW動作デモ（文字修正・表示改善版）</title>
<style>
  body {
    font-family: "Helvetica Neue", Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #f4f6f9;
    padding: 20px;
  }

  /* --- コントロールパネル --- */
  .controls {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 900px;
  }
  .btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
    color: white;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  .btn:active { transform: translateY(2px); box-shadow: none; }
  .btn:hover { opacity: 0.9; }

  .btn-auto { background-color: #34495e; }
  .btn-manual-1 { background-color: #27ae60; } /* 緑 */
  .btn-manual-2 { background-color: #d81b60; } /* ピンク */
  .btn-manual-3 { background-color: #c0392b; } /* 赤 */

  /* 選択中のボタン強調 */
  .active-mode {
    outline: 4px solid rgba(0,0,0,0.15);
    transform: scale(1.02);
  }

  .status-text {
    margin-top: 5px;
    font-weight: bold;
    color: #555;
    height: 24px;
    margin-bottom: 10px;
  }

  /* --- メインコンテナ --- */
  .container {
    position: relative;
    width: 850px;  /* 文字が切れないよう幅を確保 */
    height: 550px; /* 高さも確保 */
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden; /* はみ出し防止 */
  }

  /* --- 背景レイヤー (CSS描画) --- */
  .bg-layer {
    position: absolute; width: 100%; height: 100%; z-index: 1;
  }

  /* ケーブル線 */
  .cable-h {
    position: absolute; top: 200px; left: 180px;
    width: 580px; height: 10px; background-color: #bdc3c7; border-radius: 5px;
  }
  .cable-v-dmz {
    position: absolute; top: 200px; left: 420px;
    width: 10px; height: 180px; background-color: #bdc3c7;
  }
  .cable-v-internal {
    position: absolute; top: 200px; left: 680px;
    width: 10px; height: 60px; background-color: #bdc3c7;
  }

  /* エリア：インターネット (雲形) */
  .zone-internet {
    position: absolute; top: 130px; left: 40px;
    width: 200px; height: 120px;
    z-index: 2;
  }
  /* 雲のパーツ */
  .cloud-part {
    position: absolute; background: #e0e0e0; border-radius: 50%;
  }
  .cp1 { width: 100px; height: 100px; top: 10px; left: 20px; }
  .cp2 { width: 120px; height: 120px; top: 0px; left: 60px; }
  .cp3 { width: 90px; height: 90px; top: 30px; left: 90px; }
  .cloud-text {
    position: absolute; top: 45px; left: 0; width: 100%;
    text-align: center; font-weight: bold; color: #555; font-size: 16px; z-index: 5;
    text-shadow: 0 1px 0 rgba(255,255,255,0.5);
    line-height: 1.4;
  }

  /* ファイアウォール (レンガ壁) */
  .firewall {
    position: absolute; top: 140px; left: 400px;
    width: 50px; height: 140px;
    background: repeating-linear-gradient(45deg, #d35400, #d35400 10px, #e67e22 10px, #e67e22 20px);
    border: 4px solid #a04000;
    transform: perspective(200px) rotateY(10deg);
    z-index: 5;
    box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
  }
  .fw-label {
    position: absolute; top: 115px; left: 380px; width: 90px; text-align: center;
    font-size: 12px; font-weight: bold; color: #d35400;
  }

  /* 内部ネットワーク */
  .zone-internal {
    position: absolute; top: 270px; left: 630px; text-align: center; width: 120px;
  }
  .pc-icon {
    width: 70px; height: 50px; background: #34495e;
    border-radius: 6px; border-bottom: 6px solid #2c3e50; margin: 0 auto;
    position: relative;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  .pc-icon::after { /* スタンド */
    content: ''; position: absolute; bottom: -12px; left: 25px; width: 20px; height: 8px; background: #7f8c8d;
  }
  .pc-label { margin-top: 15px; font-weight:bold; color:#2c3e50; font-size: 14px;}

  /* DMZ */
  .zone-dmz {
    position: absolute; top: 390px; left: 360px;
    width: 140px; padding: 15px;
    border: 3px dashed #f1c40f; background-color: #fffcf0; border-radius: 12px;
    text-align: center;
  }
  .server-icon {
    width: 50px; height: 70px; background: #ecf0f1; border: 2px solid #bdc3c7;
    border-radius: 4px; margin: 0 auto 5px auto; position: relative;
    box-shadow: inset 0 0 0 4px #fff;
  }
  .server-icon::before { /* サーバーのラック線 */
    content: ''; position: absolute; top: 10px; left: 10px; width: 26px; height: 4px; background: #555;
    box-shadow: 0 8px 0 #555, 0 16px 0 #555;
  }
  .dmz-title { color: #f39c12; font-weight: bold; font-size: 18px; display: block; margin-bottom: 5px; }

  /* --- ブロック表示用メッセージ (HTMLで実装) --- */
  .blocked-msg {
    position: absolute;
    font-size: 20px;
    font-weight: 900;
    color: #e74c3c; /* 赤 */
    background-color: rgba(255, 255, 255, 0.9);
    padding: 4px 8px;
    border-radius: 4px;
    border: 2px solid #e74c3c;
    opacity: 0; /* デフォルトは非表示 */
    pointer-events: none;
    z-index: 20;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .blocked-msg span { font-size: 24px; line-height: 1; } /* バツ印 */

  /* --- SVG アニメーションレイヤー --- */
  .overlay-svg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;
  }
  
  /* パケット定義 */
  .packet { opacity: 0; } 
  .pkt-green { fill: #2ecc71; filter: drop-shadow(0 0 3px #2ecc71); }
  .pkt-pink { fill: #e91e63; filter: drop-shadow(0 0 3px #e91e63); }
  .pkt-red { fill: #c0392b; filter: drop-shadow(0 0 3px #c0392b); }


  /* --- アニメーション定義 (Keyframes) --- */

  /* 1. インターネット ⇔ DMZ (緑: 許可) */
  @keyframes path-int-dmz {
    0% { opacity: 1; transform: translate(140px, 195px); } /* Internet */
    30% { transform: translate(415px, 195px); } /* FW上 */
    45% { transform: translate(415px, 400px); } /* DMZ着 */
    55% { transform: translate(415px, 400px); } /* 滞在 */
    70% { transform: translate(415px, 195px); } /* FW戻り */
    100% { opacity: 1; transform: translate(140px, 195px); } /* Internet戻り */
  }

  /* 2. DMZ ⇒ 内部 (ピンク: 遮断) */
  @keyframes path-dmz-block {
    0% { opacity: 1; transform: translate(430px, 400px); } /* DMZ Start */
    40% { transform: translate(430px, 215px); } /* FW付近 */
    50% { transform: translate(500px, 215px); opacity: 1; } /* 少し右(内部側)へ侵入 */
    55% { transform: translate(510px, 215px); opacity: 0; } /* 消滅 */
    100% { opacity: 0; transform: translate(510px, 215px); }
  }

  /* 3. インターネット ⇒ 内部 (赤: 遮断) */
  @keyframes path-int-block {
    0% { opacity: 1; transform: translate(140px, 205px); } /* Int Start */
    40% { transform: translate(420px, 205px); } /* FW */
    50% { transform: translate(500px, 205px); opacity: 1; } /* 少し右(内部側)へ侵入 */
    55% { transform: translate(510px, 205px); opacity: 0; } /* 消滅 */
    100% { opacity: 0; transform: translate(510px, 205px); }
  }

  /* 文字の点滅アニメーション (不透明度のみ変化させるので文字は歪まない) */
  @keyframes flash-text {
    0%, 100% { opacity: 0; transform: scale(1); } /* 初期・終了 */
    10% { opacity: 1; transform: scale(1.1); } /* 出現（少し強調） */
    90% { opacity: 1; transform: scale(1); } /* 表示維持 */
  }

  /* --- JS制御用のクラス --- */
  /* モード1: 緑パケット */
  .mode-1 #p-green { animation: path-int-dmz 4s infinite ease-in-out; }
  
  /* モード2: ピンクパケット + 下部ブロック表示 */
  .mode-2 #p-pink { animation: path-dmz-block 3s infinite ease-out; }
  .mode-2 #msg-lower { animation: flash-text 3s infinite; animation-delay: 1.5s; } /* パケット消滅に合わせて表示 */

  /* モード3: 赤パケット + 上部ブロック表示 */
  .mode-3 #p-red { animation: path-int-block 3s infinite ease-out; }
  .mode-3 #msg-upper { animation: flash-text 3s infinite; animation-delay: 1.5s; }

</style>
</head>
<body>

<div class="controls">
  <button class="btn btn-auto active-mode" onclick="setMode('auto', this)">自動モード (全パターン)</button>
  <button class="btn btn-manual-1" onclick="setMode('manual-1', this)">① ネット ⇔ DMZ (双方向OK)</button>
  <button class="btn btn-manual-2" onclick="setMode('manual-2', this)">② DMZ ⇒ 内部 (×閲覧不可)</button>
  <button class="btn btn-manual-3" onclick="setMode('manual-3', this)">③ ネット ⇒ 内部 (×閲覧不可)</button>
</div>

<div class="status-text" id="status-display">自動再生中...</div>

<div class="container" id="stage">
  <div class="bg-layer">
    <div class="cable-h"></div>
    <div class="cable-v-dmz"></div>
    <div class="cable-v-internal"></div>

    <div class="zone-internet">
      <div class="cloud-part cp1"></div>
      <div class="cloud-part cp2"></div>
      <div class="cloud-part cp3"></div>
      <div class="cloud-text">インターネット<br>(外部NW)</div>
    </div>
    
    <div class="fw-label">Firewall</div>
    <div class="firewall"></div>

    <div class="zone-internal">
      <div class="pc-icon"></div>
      <div class="pc-label">内部NW<br>(社内PC)</div>
    </div>

    <div class="zone-dmz">
      <span class="dmz-title">DMZ</span>
      <div class="server-icon"></div>
      <div style="font-size:13px; font-weight:bold; color:#7f6000;">公開サーバ</div>
    </div>

    <div class="blocked-msg" id="msg-upper" style="top: 170px; left: 510px;">
        <span>×</span> 閲覧不可
    </div>

    <div class="blocked-msg" id="msg-lower" style="top: 230px; left: 510px;">
        <span>×</span> 閲覧不可
    </div>
  </div>

  <svg class="overlay-svg">
    <defs>
      <circle id="pkt-shape" r="8" />
    </defs>

    <use xlink:href="#pkt-shape" class="packet pkt-green" id="p-green" />

    <use xlink:href="#pkt-shape" class="packet pkt-pink" id="p-pink" />

    <use xlink:href="#pkt-shape" class="packet pkt-red" id="p-red" />
  </svg>
</div>

<script>
  let autoInterval = null;
  const stage = document.getElementById('stage');
  const statusDisplay = document.getElementById('status-display');

  // 初期実行
  startAutoMode();

  function setMode(mode, btnElement) {
    // ボタンのアクティブ表示切り替え
    document.querySelectorAll('.btn').forEach(b => b.classList.remove('active-mode'));
    btnElement.classList.add('active-mode');

    // アニメーションリセット
    resetAnimations();

    // オートモード解除
    if (autoInterval) clearInterval(autoInterval);

    if (mode === 'auto') {
      statusDisplay.textContent = "自動再生中: 全パターンを巡回しています...";
      startAutoMode();
    } else if (mode === 'manual-1') {
      statusDisplay.textContent = "手動: インターネットとDMZの通信 (許可)";
      stage.classList.add('mode-1');
    } else if (mode === 'manual-2') {
      statusDisplay.textContent = "手動: DMZから内部ネットワークへの侵入 (遮断)";
      stage.classList.add('mode-2');
    } else if (mode === 'manual-3') {
      statusDisplay.textContent = "手動: インターネットから内部ネットワークへの侵入 (遮断)";
      stage.classList.add('mode-3');
    }
  }

  function resetAnimations() {
    stage.classList.remove('mode-1', 'mode-2', 'mode-3');
    // 強制的にリフローさせてアニメーションを再始動させるハック（連打対策）
    void stage.offsetWidth;
  }

  function startAutoMode() {
    let step = 0;
    
    const runStep = () => {
      resetAnimations();

      if (step === 0) {
        stage.classList.add('mode-1'); // 緑
      } else if (step === 1) {
        stage.classList.add('mode-2'); // ピンク
      } else if (step === 2) {
        stage.classList.add('mode-3'); // 赤
      }
      
      step = (step + 1) % 3;
    };

    runStep(); // 初回実行
    autoInterval = setInterval(runStep, 4000); // 4秒ごとに切り替え
  }
</script>

</body>
</html>
